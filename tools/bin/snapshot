#!/bin/bash
set -e

# Get optional label from the first argument
LABEL=$1

# Create a timestamp
TIMESTAMP=$(date +%Y%m%d%H%M%S)

# Construct filename. Add label if it's not empty.
if [ -n "$LABEL" ]; then
    FILENAME="data/logs/${TIMESTAMP}_${LABEL}.md"
else
    FILENAME="data/logs/${TIMESTAMP}.md"
fi

# Ensure log directory exists
LOG_DIR=$(dirname "$FILENAME")
mkdir -p "$LOG_DIR"

# Concatenate aider history files into the new log file
# These files are expected to be in the repository root.
# Handle cases where one or both files may not exist.
for f in .aider.chat.history.md .aider.input.history; do
    if [ -f "$f" ]; then
        cat "$f" >> "$FILENAME"
    fi
done

echo "Created snapshot: ${FILENAME}"
