#!/bin/bash
SESSION="mission-control"
BIN_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
MONITOR_CMD="${MISSION_MONITOR:-/bin/bash}"

# Cleanup old session for testing
tmux kill-session -t "$SESSION" 2>/dev/null

echo "üöÄ Initializing Mock Cockpit..."

# 1. Start Session (Pane 0: Will be Architect)
tmux new-session -d -s "$SESSION" -n "Cockpit"

# 2. Split Main Columns (Left vs Right)
# Target Pane 0. Split Horizontally (-h). Right side gets 65% width.
# Result: Pane 0 (Left), Pane 1 (Right)
tmux split-window -t "$SESSION:Cockpit.0" -h -p 65

# 3. Split Right Column (Coder vs Ops)
# Target Pane 1 (Right). Split Vertically (-v). Bottom gets 25% height.
# Result: Pane 1 (Top Right), Pane 2 (Bottom Right)
tmux split-window -t "$SESSION:Cockpit.1" -v -p 25

# 4. Split Ops Row (Shell vs Monitor)
# Target Pane 2 (Bottom Right). Split Horizontally (-h). 
# Result: Pane 2 (Bottom Right Left), Pane 3 (Bottom Right Right)
tmux split-window -t "$SESSION:Cockpit.2" -h -p 50

# --------------------------------------------------------------------------
# ASSIGN ROLES
# --------------------------------------------------------------------------

# Pane 0: Architect (Left)
tmux send-keys -t "$SESSION:Cockpit.0" "clear; $BIN_DIR/architect" C-m

# Pane 1: Coder (Top Right - Main Focus)
tmux send-keys -t "$SESSION:Cockpit.1" "clear; $BIN_DIR/coder" C-m

# Pane 2: Interactive Shell (Bottom Center)
tmux send-keys -t "$SESSION:Cockpit.2" "echo '--- üêö Shell ---'; ls -F" C-m

# Pane 3: Monitor (Bottom Right)
tmux send-keys -t "$SESSION:Cockpit.3" "echo '--- üî≠ Monitor ---'; $MONITOR_CMD" C-m

# --------------------------------------------------------------------------
# LAUNCH
# --------------------------------------------------------------------------
# Focus on the Coder pane (1) by default
tmux select-pane -t "$SESSION:Cockpit.1"
exec tmux attach-session -t "$SESSION"
